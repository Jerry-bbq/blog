(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{383:function(t,e,a){t.exports=a.p+"assets/img/reactive2.1ba7f131.png"},384:function(t,e,a){t.exports=a.p+"assets/img/reactive.c9e2ac37.png"},455:function(t,e,a){"use strict";a.r(e);var s=a(26),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"响应式原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#响应式原理"}},[t._v("#")]),t._v(" 响应式原理")]),t._v(" "),s("p",[t._v("简单概述：")]),t._v(" "),s("p",[t._v("采用"),s("strong",[t._v("数据劫持")]),t._v("结合"),s("strong",[t._v("发布-订阅模式")]),t._v(",通过 "),s("code",[t._v("Object.defineProperty")]),t._v(" 来劫持各个属性的"),s("code",[t._v("getter")]),t._v("和"),s("code",[t._v("setter")]),t._v(",在数据变动时发布消息给"),s("strong",[t._v("订阅者")]),t._v(",触发相应的"),s("strong",[t._v("监听回调")])]),t._v(" "),s("p",[t._v("详细描述：")]),t._v(" "),s("p",[t._v("当创建 Vue 实例时,会遍历 "),s("code",[t._v("data 选项")]),t._v("的属性,利用 "),s("code",[t._v("Object.defineProperty")]),t._v(" 为属性添加 "),s("code",[t._v("getter")]),t._v(" 和 "),s("code",[t._v("setter")]),t._v(" 对数据的读取进行劫持（"),s("code",[t._v("getter")]),t._v(" 用来"),s("strong",[t._v("依赖收集")]),t._v(","),s("code",[t._v("setter")]),t._v(" 用来"),s("strong",[t._v("派发更新")]),t._v("）,并且在内部追踪依赖,在属性被访问和修改时通知变化。")]),t._v(" "),s("p",[t._v("每个组件实例会有相应的 "),s("code",[t._v("watcher")]),t._v(" 实例,会在组件渲染的过程中记录依赖的所有数据属性（进行依赖收集,还有 "),s("code",[t._v("computed watcher")]),t._v(","),s("code",[t._v("user watcher")]),t._v(" 实例）,之后依赖项被改动时,"),s("code",[t._v("setter")]),t._v(" 方法会通知依赖与此 data 的 watcher 实例重新计算（派发更新）,从而使它关联的组件重新渲染。")]),t._v(" "),s("p",[t._v("实现响应式有三个核心类：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类名")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Observe")]),t._v(" "),s("td",[t._v("数据的"),s("code",[t._v("观察者")])])]),t._v(" "),s("tr",[s("td",[t._v("Watcher")]),t._v(" "),s("td",[t._v("数据的"),s("code",[t._v("订阅者")]),t._v("，数据变化会通知Watcher，然后由Watcher进行相应的操作，例如更新视图")])]),t._v(" "),s("tr",[s("td",[t._v("Dep")]),t._v(" "),s("td",[t._v("Observe和Watcher的"),s("code",[t._v("纽带")]),t._v("，当数据发生变化时，会被Observe观察到，然后由Dep通知到Watcher")])])])]),t._v(" "),s("h2",{attrs:{id:"observe类观察者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#observe类观察者"}},[t._v("#")]),t._v(" Observe类观察者")]),t._v(" "),s("p",[t._v("概述：")]),t._v(" "),s("p",[t._v("使用"),s("RouterLink",{attrs:{to:"/frame/vue/v2/component/defineProperty.html"}},[t._v("Object.defineProperty")]),t._v("给对象的属性添加 "),s("code",[t._v("getter")]),t._v(" 和 "),s("code",[t._v("setter")]),t._v("，用于"),s("strong",[t._v("依赖收集")]),t._v("和"),s("strong",[t._v("派发更新")])],1),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/frame/vue/v2/component/Observer.html"}},[t._v("Observe对象实现")]),t._v("关键步骤：")],1),t._v(" "),s("ol",[s("li",[t._v("实例化Dep")]),t._v(" "),s("li",[t._v("调用"),s("RouterLink",{attrs:{to:"/frame/vue/v2/component/def.html"}},[t._v("def()")]),t._v("把自身实例添加到数据对象 "),s("code",[t._v("value")]),t._v(" 的 "),s("code",[t._v("__ob__")]),t._v(" 属性上")],1),t._v(" "),s("li",[t._v("属性如果是对象，则遍历对象属性调用"),s("RouterLink",{attrs:{to:"/frame/vue/v2/component/defineReactive.html"}},[t._v("defineReactive()")]),t._v("；如果数组，则遍历数组调用"),s("RouterLink",{attrs:{to:"/frame/vue/v2/component/observe.html"}},[t._v("observe()")])],1)]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/frame/vue/v2/component/my-observe.html"}},[t._v("Observe的简单实现")])],1),t._v(" "),s("h2",{attrs:{id:"dep类纽带"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dep类纽带"}},[t._v("#")]),t._v(" Dep类纽带")]),t._v(" "),s("ul",[s("li",[t._v("用于收集当前响应式对象的依赖关系")]),t._v(" "),s("li",[t._v("每个响应式对象包括子对象都拥有一个 Dep 实例（里面 subs 是 Watcher 实例数组")]),t._v(" "),s("li",[t._v("当数据有变更时,会通过 dep.notify()通知各个 watcher（Dep 实际上就是对 Watcher 的一种管理）")])]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/frame/vue/v2/dep/dep.html"}},[t._v("Dep类")]),t._v("主要是定义了一些属性和方法：")],1),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性和方法")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("addSub")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("removeSub")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("depend")]),t._v(" "),s("td",[t._v("添加依赖（实际上是调用Watcher的"),s("code",[t._v("addDep()")]),t._v("）")])]),t._v(" "),s("tr",[s("td",[t._v("notify")]),t._v(" "),s("td",[t._v("派发更新（通知订阅者）（实际上是调用Wathcer的"),s("code",[t._v("update()")]),t._v("方法）")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),s("p",[t._v("Dep是Watcher实例的管理者。Dep 是一个类，用于依赖收集和派发更新，也就是存放"),s("code",[t._v("Watcher实例")]),t._v("和触发Watcher实例上的"),s("code",[t._v("update")])])]),t._v(" "),s("h2",{attrs:{id:"watcher类订阅者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#watcher类订阅者"}},[t._v("#")]),t._v(" Watcher类订阅者")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deep "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deep\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("computed "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("computed\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sync "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sync\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deep "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("computed "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sync "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("观察者对象 , 实例分为如下四种：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("watcher")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("deep watcher")]),t._v(" "),s("td",[t._v("对对象、数组进行深度的依赖收集")])]),t._v(" "),s("tr",[s("td",[t._v("user watcher")]),t._v(" "),s("td",[t._v("Vue的一般watcher")])]),t._v(" "),s("tr",[s("td",[t._v("computed watcher")]),t._v(" "),s("td",[t._v("计算属性的watcher")])]),t._v(" "),s("tr",[s("td",[t._v("sync watcher")]),t._v(" "),s("td",[t._v("不把更新watcher放到nextTick队列 而是立即执行更新")])])])]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/frame/vue/v2/watcher/watcher.html"}},[t._v("Watcher")]),t._v("的关键步骤：")],1),t._v(" "),s("ul",[s("li",[t._v("get")]),t._v(" "),s("li",[t._v("addDep：依赖收集")]),t._v(" "),s("li",[t._v("update：派发更新，触发组件重新渲染")])]),t._v(" "),s("h2",{attrs:{id:"三者关系图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三者关系图"}},[t._v("#")]),t._v(" 三者关系图")]),t._v(" "),s("p",[t._v("来源于"),s("a",{attrs:{href:"https://segmentfault.com/a/1190000016208088",target:"_blank",rel:"noopener noreferrer"}},[t._v("segmentfault"),s("OutboundLink")],1),t._v(" "),s("img",{attrs:{src:a(383),alt:""}})]),t._v(" "),s("p",[t._v("来源于"),s("a",{attrs:{href:"https://ustbhuangyi.github.io/vue-analysis/v2/reactive/summary.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ustbhuangyi"),s("OutboundLink")],1),t._v(" "),s("img",{attrs:{src:a(384),alt:""}})])])}),[],!1,null,null,null);e.default=r.exports}}]);